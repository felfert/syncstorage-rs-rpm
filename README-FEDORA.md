# How to setup your own firefox sync server

After installing the package `syncstorage-rs`, it is mandatory to perform several additional tasks

### 1. Create a mariadb user and database

- If you do not have a working mariadb installation, see [here]( https://docs.fedoraproject.org/en-US/quick-docs/installing-mysql-mariadb/#_install_from_fedora_main_repo).
- Run the following command(s) in a shell:
```
DBPASSWORD=$(openssl rand -base64 128)
echo The database password is ${DBPASSWORD}
sudo mysql -u root <<EOF
CREATE USER "ffsync"@"localhost" IDENTIFIED BY "${DBPASSWORD}";
CREATE DATABASE ffsync;
GRANT ALL PRIVILEGES on ffsync.* to ffsync@localhost;
EOF
```
### 2. Customize /etc/syncserver.toml

- Edit `/etc/syncserver.toml`

  Change the values of `master_secret`, `syncstorage.database_url` and `tokenserver.database_url`.
  `master_secret` should be a random string that could be generated by running `openssl rand -base64 128`
  Both database urls should point to the same database created above. the generic syntax for those urls is
  mysql://`username`:`password`@`hostname`/`dbname`[?`options`]
  The example values use a unix socket. If your database happens to run on a remote machine, then you must remove the trailing `?unix_socket=/var/lib/mysql/mysql.sock`.

### 3. Customize /etc/sysconfig/syncserver

- Edit `/etc/sysconfig/syncserver`

  In this file, the environment variables used by the syncserver are specified.

  - `RUST_LOG` specifies the log devel
  - `PUBLIC_URL` specifies the URL which is used from the client side. This points to the public side of a reverse proxy. See sample apache config below. The string value is used to set the node value in the nodes table.
 - `MAX_CLIENTS` specifies the maximum number of users, that can use this syncserver. For a personal syncserver, you usually want to keep the dfault of `1`.

### 4. Setup reverse proxy (apache virtual host)

 Here is an example config that goes into /etc/httpd/conf.d/ffsync.conf:

```
TBD
```
